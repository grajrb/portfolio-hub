name: Deploy to Vercel

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    name: Deploy to Vercel
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      # Deploy to Vercel using community action. This requires the following repository secrets:
      # - VERCEL_TOKEN       (create in Vercel dashboard: Settings -> Tokens -> Create)
      # - VERCEL_ORG_ID      (your Vercel organization id)
      # - VERCEL_PROJECT_ID  (your Vercel project id)
      # You can find Org and Project IDs in the Vercel dashboard (Project Settings -> General).
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: .
          prod: true

      - name: Output deployment URL
        run: echo "Deployment finished"

# Notes / Next steps:
# 1) Add the three secrets above in your GitHub repository Settings -> Secrets -> Actions.
# 2) To create VERCEL_TOKEN: go to https://vercel.com/account/tokens and create a new token.
# 3) To find VERCEL_ORG_ID and VERCEL_PROJECT_ID: open Vercel dashboard -> select your project -> Settings -> General -> scroll to 'Project ID' and 'Organization'.
# 4) IMPORTANT: GitHub will refuse pushes that create/update workflow files when you authenticate with an HTTPS PAT that lacks the 'workflow' scope. If your push fails, create a PAT with the 'workflow' scope, or push via SSH.